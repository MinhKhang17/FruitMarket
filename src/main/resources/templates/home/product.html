<!-- file: src/main/resources/templates/home/product.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Products</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- CSS riêng của trang Products (palette xanh lá như Home) -->
    <link th:href="@{/product.css}" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <h1 class="page-title">All Products</h1>

    <div th:if="${#lists.isEmpty(products)}" class="no-product">
        <p>No products found.</p>
    </div>

    <div class="row g-4" th:if="${!#lists.isEmpty(products)}">
        <div class="col-md-4" th:each="p : ${products}">
            <div class="product-card h-100">
                <!-- Image (Product.image is OneToOne) -->
                <img class="img-fluid rounded mb-2"
                     th:src="${p.getVariants().get(0).getImage() == null ? '/images/placeholder.png' : p.getVariants().get(0).getImage().getUrl()}"
                     th:alt="${p.product_name}"/>

                <h2 class="product-name" th:text="${p.product_name}">Product name</h2>
                <p class="product-text" th:text="${p.product_description}">Description</p>

                <!-- Price: lấy giá của variant đầu tiên (an toàn với PersistentBag) -->
                <p class="product-text">
                    <span class="product-strong">Price:</span>
                    <span th:text="${
                        (p.variants != null && !p.variants.isEmpty())
                        ? #numbers.formatDecimal(p.variants[0].price, 0, 'COMMA', 2, 'POINT')
                        : (p.product_price != null ? #numbers.formatDecimal(p.product_price,0,'COMMA',2,'POINT') : '—')
                    }">0.00</span>
                </p>

                <p class="product-text">
                    <span class="product-strong">Category:</span>
                    <span th:text="${p.category != null ? p.category.name : '—'}">Category</span>
                </p>
                <p class="product-text">
                    <span class="product-strong">Brand:</span>
                    <span th:text="${p.brand != null ? p.brand.name : '—'}">Brand</span>
                </p>

                <div class="mt-3">
                    <a class="btn btn-leaf btn-sm" th:href="@{|/products/${p.id}|}" target="_top">View</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
