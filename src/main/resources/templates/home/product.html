<div class="col-md-4" th:each="p : ${products}">
    <div class="card h-100 shadow-sm border-0 product-card">
        <!-- ✅ Ảnh từ variant đầu tiên -->
        <img class="card-img-top img-fluid rounded-top"
             th:src="${!#lists.isEmpty(p.variants) && p.variants.get(0).image != null
                        ? p.variants.get(0).image.url
                        : '/images/placeholder.png'}"
             th:alt="${p.productName}"
             onerror="this.src='/images/placeholder.png'"/>

        <div class="card-body">
            <h5 class="card-title" th:text="${p.productName}">Product name</h5>
            <p class="card-text text-muted small" th:text="${p.product_description}">Description...</p>

            <p class="mb-1">
                <strong>Price:</strong>
                <span th:text="${
                    (p.variants != null && !p.variants.isEmpty() && p.variants.get(0).price != null)
                    ? #numbers.formatDecimal(p.variants.get(0).price, 0, 'COMMA', 2, 'POINT')
                    : '—'
                }">0.00</span>
            </p>

            <p class="mb-1">
                <strong>Category:</strong>
                <span th:text="${p.category != null ? p.category.name : '—'}">Category</span>
            </p>

            <p class="mb-3">
                <strong>Brand:</strong>
                <span th:text="${p.brand != null ? p.brand.name : '—'}">Brand</span>
            </p>

            <a class="btn btn-primary btn-sm w-100" th:href="@{|/products/${p.id}|}">View Details</a>
        </div>
    </div>
</div>
