<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FruitMarket - Home</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <style>
        /* ========== Cấu hình chính ========== */
        :root {
            --primary-leaf: #2f9e44;
            --primary-leaf-light: #51cf66;
            --shadow-md: 0 8px 24px rgba(30, 30, 30, 0.08);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: #f8faf9;
        }

        /* ========== Hero Banner ========== */
        .hero-banner {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            height: 400px;
        }
        .hero-banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: none;
        }
        .hero-banner-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .hero-banner-content {
            color: white;
        }
        .hero-banner-content h1 {
            font-weight: 800;
            font-size: 2.5rem;
            text-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .btn-hero {
            border-radius: 50px;
            font-weight: 600;
        }

        /* ========== Product Card ========== */
        .product-card {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: 0.2s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        }
        .product-image-wrapper {
            position: relative;
            overflow: hidden;
        }
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: .5rem;
            flex-grow: 1;
        }
        .product-name {
            font-weight: 700;
            color: #222;
        }
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #e9ecef;
            padding-top: 0.75rem;
            margin-top: auto;
        }
        .btn-view-product {
            color: var(--primary-leaf);
            border: 2px solid var(--primary-leaf);
            border-radius: 8px;
            font-weight: 600;
            padding: .4rem .9rem;
            text-decoration: none;
        }
        .btn-view-product:hover {
            background: var(--primary-leaf);
            color: white;
        }
    </style>
</head>

<body>
<!-- Header -->
<div th:replace="fragments/header :: header"></div>

<main class="page-wrap">
    <div class="container py-4">

        <!-- ========== Hero Banner ========== -->
        <section class="hero-banner mb-5">
            <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="4000">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img th:src="@{/images/heroBanner.jpg}" class="hero-banner-img" alt="Fresh Fruits">
                        <div class="hero-banner-overlay">
                            <div class="hero-banner-content">
                                <h1>Fresh & Organic Fruits</h1>
                                <p>Discover the best local and imported produce</p>
                                <a href="#latest-products" class="btn btn-hero btn-light mt-2">Shop Now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== Latest Products ========== -->
        <section id="latest-products" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="fw-bold">Latest Products</h2>
                <a th:href="@{/products}" class="text-decoration-none fw-semibold text-success">View All →</a>
            </div>

            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                <div class="col" th:each="p : ${latestProducts}">
                    <div class="product-card">
                        <div class="product-image-wrapper ratio ratio-1x1">
                            <!-- ✅ lấy ảnh từ variant đầu tiên -->
                            <img th:src="${(p.variants != null and !p.variants.isEmpty() and p.variants[0].image != null)
                                            ? p.variants[0].image.url
                                            : '/images/placeholder.png'}"
                                 th:alt="${p.productName}"
                                 onerror="this.src='/images/placeholder.png'"
                                 class="product-image">
                        </div>

                        <div class="product-body">
                            <div class="text-muted text-uppercase small"
                                 th:text="${p.brand != null ? p.brand.name : 'No Brand'}">Brand</div>
                            <h6 class="product-name" th:text="${p.productName}">Product Name</h6>
                            <p class="text-secondary small" th:text="${p.product_description}">Description</p>

                            <div class="product-footer">
                                <div class="fw-bold text-success">
                                    <span th:text="${(p.variants != null && !p.variants.isEmpty())
                                        ? #numbers.formatDecimal(p.variants[0].price, 0, 'COMMA', 2, 'POINT')
                                        : '0'}">0</span><span> đ</span>
                                </div>
                                <a th:href="@{|/products/${p.id}|}" class="btn-view-product">View</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== By Category ========== -->
        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="fw-bold">Shop by Category</h2>
                <a th:href="@{/categories}" class="text-decoration-none fw-semibold text-success">All Categories →</a>
            </div>

            <div class="tab-content">
                <div class="tab-pane active show">
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4"
                         th:each="c : ${categories}">
                        <div th:each="p : ${categoryProducts[c.id]}" class="col">
                            <div class="product-card">
                                <div class="product-image-wrapper ratio ratio-1x1">
                                    <img th:src="${(p.variants != null and !p.variants.isEmpty() and p.variants[0].image != null)
                                                    ? p.variants[0].image.url
                                                    : '/images/placeholder.png'}"
                                         th:alt="${p.productName}"
                                         onerror="this.src='/images/placeholder.png'"
                                         class="product-image">
                                </div>
                                <div class="product-body">
                                    <div class="text-muted small text-uppercase" th:text="${p.brand.name}">Brand</div>
                                    <h6 class="product-name" th:text="${p.productName}">Product</h6>
                                    <p class="text-secondary small" th:text="${p.product_description}">Description</p>
                                    <div class="product-footer">
                                        <div class="fw-bold text-success">
                                            <span th:text="${(p.variants != null && !p.variants.isEmpty())
                                                ? #numbers.formatDecimal(p.variants[0].price, 0, 'COMMA', 2, 'POINT')
                                                : '0'}">0</span><span> đ</span>
                                        </div>
                                        <a th:href="@{|/products/${p.id}|}" class="btn-view-product">View</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== By Brand ========== -->
        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="fw-bold">Shop by Brand</h2>
                <a th:href="@{/brands}" class="text-decoration-none fw-semibold text-success">All Brands →</a>
            </div>

            <div th:each="b : ${brands}" class="mb-4">
                <h4 class="fw-bold text-success mb-3" th:text="${b.name}">Brand Name</h4>
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4"
                     th:if="${brandProducts[b.id] != null}">
                    <div class="col" th:each="p : ${brandProducts[b.id]}">
                        <div class="product-card">
                            <div class="product-image-wrapper ratio ratio-1x1">
                                <img th:src="${(p.variants != null and !p.variants.isEmpty() and p.variants[0].image != null)
                                                ? p.variants[0].image.url
                                                : '/images/placeholder.png'}"
                                     th:alt="${p.productName}"
                                     onerror="this.src='/images/placeholder.png'"
                                     class="product-image">
                            </div>
                            <div class="product-body">
                                <div class="text-muted small text-uppercase" th:text="${p.brand.name}">Brand</div>
                                <h6 class="product-name" th:text="${p.productName}">Product</h6>
                                <p class="text-secondary small" th:text="${p.product_description}">Description</p>
                                <div class="product-footer">
                                    <div class="fw-bold text-success">
                                        <span th:text="${(p.variants != null && !p.variants.isEmpty())
                                            ? #numbers.formatDecimal(p.variants[0].price, 0, 'COMMA', 2, 'POINT')
                                            : '0'}">0</span><span> đ</span>
                                    </div>
                                    <a th:href="@{|/products/${p.id}|}" class="btn-view-product">View</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
